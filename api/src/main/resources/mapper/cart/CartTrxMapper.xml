<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="vibe.api.repository.CartTrxMapper">

    <!-- 장바구니 추가 -->
    <insert id="insertCart" parameterType="vibe.api.entity.Cart">
        INSERT /* CartTrxMapper.insertCart */
          INTO CART (
               MEMBER_NO
             , PRODUCT_NO
             , QTY
             , CREATED_AT
        )
        VALUES (
               #{memberNo}
             , #{productNo}
             , 1
             , NOW()
        )
        ON CONFLICT (MEMBER_NO, PRODUCT_NO)
        DO UPDATE SET QTY = CART.QTY + 1
                    , UPDATED_AT = NOW()
    </insert>

    <!-- 장바구니 수량 증가 -->
    <update id="updateCartQty">
        UPDATE /* CartTrxMapper.updateCartQty */
               CART
           SET QTY = QTY + 1
             , UPDATED_AT = NOW()
         WHERE MEMBER_NO = #{memberNo}
           AND PRODUCT_NO = #{productNo}
    </update>

    <!-- 장바구니 수량 변경 (특정 수량으로 설정) -->
    <update id="updateCartQtyByCartId">
        UPDATE /* CartTrxMapper.updateCartQtyByCartId */
               CART
           SET QTY = #{qty}
             , UPDATED_AT = NOW()
         WHERE CART_ID = #{cartId}
    </update>

    <!-- 장바구니 삭제 (여러 개) -->
    <delete id="deleteCartByIds">
        DELETE /* CartTrxMapper.deleteCartByIds */
          FROM CART
         WHERE CART_ID IN
        <foreach collection="cartIdList" item="cartId" separator="," open="(" close=")">
            #{cartId}
        </foreach>
    </delete>

    <!-- 장바구니 전체 삭제 (회원별) -->
    <delete id="deleteCartByMemberNo" parameterType="string">
        DELETE /* CartTrxMapper.deleteCartByMemberNo */
          FROM CART
         WHERE MEMBER_NO = #{memberNo}
    </delete>

</mapper>
