<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="vibepay.api.repository.CartMapper">

    <!-- 장바구니 목록 조회 -->
    <select id="selectCartList" parameterType="string" resultType="vibepay.api.dto.response.CartResponse">
        SELECT /* CartMapper.selectCartList */
               C.CART_ID
             , C.PRODUCT_NO
             , P.PRODUCT_NAME
             , C.QTY
             , P.PRICE
          FROM CART C
         INNER JOIN PRODUCT P ON C.PRODUCT_NO = P.PRODUCT_NO
         WHERE C.MEMBER_NO = #{memberNo}
         ORDER BY C.CREATED_AT DESC
    </select>

    <!-- 장바구니 존재 여부 확인 -->
    <select id="countByMemberNoAndProductNo" resultType="int">
        SELECT /* CartMapper.countByMemberNoAndProductNo */
               COUNT(*)
          FROM CART
         WHERE MEMBER_NO = #{memberNo}
           AND PRODUCT_NO = #{productNo}
    </select>

    <!-- 장바구니 ID 리스트로 조회 -->
    <select id="selectCartByIds" resultType="vibepay.api.dto.response.CartResponse">
        SELECT /* CartMapper.selectCartByIds */
               C.CART_ID
             , C.PRODUCT_NO
             , P.PRODUCT_NAME
             , C.QTY
             , P.PRICE
          FROM CART C
         INNER JOIN PRODUCT P ON C.PRODUCT_NO = P.PRODUCT_NO
         WHERE C.CART_ID IN
        <foreach collection="cartIdList" item="cartId" open="(" separator="," close=")">
            #{cartId}
        </foreach>
         ORDER BY C.CREATED_AT DESC
    </select>

</mapper>
