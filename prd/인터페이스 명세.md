# 인터페이스 명세

스프링 내의 http 통신은 webClient 사용

## 이니시스

### <키 값>

| MID(mid) | INIpayTest | 스프링 설정 파일에서 profile별로 관리 |
| --- | --- | --- |
| SIGN_KEY(signKey) | SU5JTElURV9UUklQTEVERVNfS0VZU1RS | 스프링 설정 파일에서 profile별로 관리 |
| API_KEY(apiKey) | ItEQKi3rY7uvDS8l | 스프링 설정 파일에서 profile별로 관리 |

### <인증>

- 인증요청 JS : https://stdpay.inicis.com/stdjs/INIStdPay.js
- HTTP Method : POST
- Accept-charset : UTF-8

- 인증 요청 파라미터(form submit 방식)

| **version***** | 전문 버전 ["1.0" 고정] | "1.0" 고정 |
| --- | --- | --- |
| **gopaymethod***** | 요청지불수단
**빈값으로 세팅 시, 전체 결제수단 표시** | 신용카드: Card |
| **mid***** | 상점아이디 | 인증 파라미터 값 조회 API 응답 값에서 추출 |
| **oid***** | 주문번호
**반드시 Unique 값으로 생성 (거래추적 시 사용됨)** | 채번한 주문 번호 |
| **price***** | 결제금액
**숫자만 허용, 1달러는 100으로 시작** |  |
| **timestamp***** | 타임스템프 [TimeInMillis(Long형)] | 인증 파라미터 값 조회 API 응답 값에서 추출 |
| **use_chkfake***** | PC결제 보안강화 사용  | 값 설정X |
| **signature***** | SHA256 Hash값
**대상: oid, price, timestamp** | 인증 파라미터 값 조회 API 응답 값에서 추출 |
| **verification***** | SHA256 Hash값
**대상: oid, price, signKey, timestamp** | 인증 파라미터 값 조회 API 응답 값에서 추출 |
| **mKey***** | SHA256 Hash값
**대상: mid 와 매칭되는 signKey** | 인증 파라미터 값 조회 API 응답 값에서 추출 |
| **currency***** | 통화구분 ["WON":한화,"USD":달러]
**USD는 카드 결제만 가능** | “WON” 고정 |
| **goodname***** | 상품명
**40Byte 초과 요청시 37Byte + ...으로 자동 변환** |  |
| **buyername***** | 구매자명
**30Byte 초과 요청시 30Byte로 자동 변환** |  |
| **buyertel***** | 구매자 휴대폰번호
**숫자와 "-" 만 허용** |  |
| **buyeremail***** | 구매자 이메일주소
**"@", "." 외 특수문자 입력불가** |  |
| **returnUrl***** | 결과수신 URL | ${*window*.location.origin}/api/payment
(route Handlers 페이지) |
| **closeUrl***** | 결제창 닫기 URL | 주문서에 계속 머물러야 하는 걸 고려해서 설정 |
| **acceptmethod***** | "centerCd(Y)" IDC센터코드 수신 사용옵션 세팅 필수ex) acceptmethod = centerCd(Y)
**여러옵션 추가 세팅 시 ":"(콜론) 구분자 사용** | HPP(1):below1000 로 고정 |

- 응답

| **resultCode** | 결과코드
**"0000":성공, 이외 실패** |  |
| --- | --- | --- |
| **resultMsg** | 결과메시지 |  |
| **mid** | 상점아이디 |  |
| **orderNumber** | 주문번호
**결제요청 시 세팅한 주문번호** |  |
| **authToken** | 승인요청 검증 토큰 |  |
| **idc_name** | IDC센터코드 [fc, ks, stg]
**승인요청 시 authUrl 과 비교검증 필요** |  |
| **authUrl** | 승인요청 Url
**해당 URL로 HTTPS API Request 승인요청** |  |
| **netCancelUrl** | 망취소요청 Url
**승인요청 후 승인결과 수신 실패 / DB저장 실패 시** |  |
| **charset** | 인증결과 인코딩 [Default: UTF-8] |  |
| **merchantData** | 가맹점 임의 데이터 |  |

### <승인>

- 승인 요청 URL : STEP2 인증 결과 수신 시 응답된 authUrl
- Content-type: application/x-www-form-urlencoded
- HTTP Method : POST
- 통신방식 : http-Client 통신

- 승인 요청 파라미터

| **mid***** | 상점아이디 | 스프링 설정 파일에 있음 |
| --- | --- | --- |
| **authToken***** | 승인요청 검증 토큰 | 인증 결과에 있는 데이터 |
| **timestamp***** | 타임스템프 [TimeInMillis(Long형)] |  |
| **signature***** | SHA256 Hash값
**대상: authToken, timestamp** | NVP 방식 : authToken=authTokenValue&timestamp=timestampValue 으로 생성된 값 |
| **verification***** | SHA256 Hash값
**대상: authToken, signKey, timestamp** | NVP 방식 : authToken=authTokenValue&signKey=signKeyValue&timestamp=timestampValue 으로 생성된 값 |
| **charset***** | 인증결과 인코딩 [Default: UTF-8] | 값 설정 필요X, Default로 설정 되도록 |
| **format***** | 리턴형식 [XML, JSON, NVP] | JSON 고정 |

- 응답

| **resultCode** | 결과코드
**"0000":성공, 이외 실패 (실패코드 6byte)** |  |
| --- | --- | --- |
| **resultMsg** | 결과메세지 |  |
| **tid** | 거래번호 |  |
| **mid** | 상점아이디 |  |
| **MOID** | 주문번호
**결제 요청시 oid 필드에 설정된 값** |  |
| **TotPrice** | 결제금액 |  |
| **goodName** | 상품명 |  |
| **payMethod** | 지불수단 |  |
| **applDate** | 승인일자 [YYYYMMDD] |  |
| **applTime** | 승인시간 [hh24miss] |  |
| **applNum** | 승인번호 |  |

### <취소>

이니시스는 전체 취소/부분 취소 API가 별개

- 전체 취소

**취소요청URL** : https://iniapi.inicis.com/v2/pg/refund

**Header 정보:**
POST /v2/pg/refund HTTP/1.1
Host: iniapi.inicis.com
Content-type: application/json

- 전체 취소 요청 파라미터

| **mid***** | String | 상점아이디 | 스프링 설정 파일에 있음 |
| --- | --- | --- | --- |
| **type***** | String | 요청서비스 ["refund" 고정] | "refund" 고정 |
| **timestamp***** | String | 전문생성시간 [YYYYMMDDhhmmss] |  |
| **clientIp***** | String | 가맹점 요청 서버IP (추후 거래 확인 등에 사용됨) | "127.0.0.1" 고정 |
| **hashData***** | String | SHA512 HASH 한 값
**대상 : INIAPIKey + mid + type + timestamp + data** | **apiKey+ mid + type + timestamp + data(json string 변환)을 이어 붙인 문자열을 SHA-512로 HASH 한 값** |
| **data***** | Data | 요청데이터 |  |
| **Data 상세** |  |  |  |
| **tid***** | String | 취소요청할 승인TID | 승인 결과에 있던 tid
결제 테이블에 저장되어 있음 |
| **msg***** | String | 취소요청 사유 | “단순변심” 고정 |

-  응답

| **resultCode** | 결과코드
**"00":성공, 이외 실패** |  |
| --- | --- | --- |
| **resultMsg** | 결과메세지 |  |
- 부분 취소

**취소요청URL** : https://iniapi.inicis.com/v2/pg/partialRefund

**Header 정보:**
POST /v2/pg/partialRefund HTTP/1.1
Host: iniapi.inicis.com
Content-type: application/json

- 요청 파라미터

| **mid***** | String | 상점아이디 | 스프링 설정 파일에 있음 |
| --- | --- | --- | --- |
| **type***** | String | 요청서비스 ["partialRefund" 고정] | "partialRefund" 고정 |
| **timestamp***** | String | 전문생성시간 [YYYYMMDDhhmmss] |  |
| **clientIp***** | String | 가맹점 요청 서버IP (추후 거래 확인 등에 사용됨) | "127.0.0.1" 고정 |
| **hashData***** | String | SHA512 HASH 한 값
**대상 : INIAPIKey + mid + type + timestamp + data** | **apiKey+ mid + type + timestamp + data(json string 변환)을 이어 붙인 문자열을 SHA-512로 HASH 한 값** |
| **data***** | Data | 요청데이터 |  |
| **Data 상세** |  |  |  |
| **tid***** | String | 취소요청할 승인TID | 승인 결과에 있던 tid
결제 테이블에 저장되어 있음 |
| **msg***** | String | 취소요청 사유 | “단순변심” 고정 |
| **price***** | String | 취소요청 금액 |  |
| **confirmPrice***** | String | 부분취소 후 남은 금액 |  |

- 응답

| **resultCode** | 결과코드
**"00":성공, 이외 실패** |  |
| --- | --- | --- |
| **resultMsg** | 결과메세지 |  |

### <망취소>

이니시스는 망취소 API도 취소와 별개로 존재

- 망취소요청 URL : STEP2 인증결과 수신 시 응답된 netCancelUrl
- Content-type: application/x-www-form-urlencoded
- HTTP Method : POST
- 통신방식 : http-Client 통신

- 요청 파라미터

| **mid***** | 상점아이디 | 스프링 설정 파일에 있음 |
| --- | --- | --- |
| **authToken***** | 승인요청 검증 토큰 | 승인 요청 파라미터에 있는 값 |
| **timestamp***** | 타임스템프 [TimeInMillis(Long형)] |  |
| **signature***** | SHA256 Hash값
**대상: authToken, timestamp** | NVP 방식 : authToken=authTokenValue&timestamp=timestampValue 으로 생성된 값 |
| **verification***** | SHA256 Hash값
**대상: authToken, signKey, timestamp** | NVP 방식 : authToken=authTokenValue&signKey=signKeyValue&timestamp=timestampValue 으로 생성된 값 |
| **charset***** | 인증결과 인코딩 [Default: UTF-8] | UTF-8 고정 |
| **format***** | 리턴형식 [XML, JSON, NVP] | JSON 고정 |

- 응답

| **resultCode** | 결과코드
**"0000":성공, 이외 실패 (실패코드 6byte)** |  |
| --- | --- | --- |
| **resultMsg** | 결과메세지 |  |

## **토스**

망취소는 취소API를 사용

### <키 값>

| clientKey | test_ck_DpexMgkW36PL5OnYYn7drGbR5ozO | FO 설정 파일에서 profile별로 관리 |
| --- | --- | --- |
| apiKey | test_sk_P9BRQmyarY56W4lPgbnNrJ07KzLN | 스프링 설정 파일에서 profile별로 관리 |

### <인증>

- 결제요청 JS: https://js.tosspayments.com/v1/payment

- 인증 요청 파라미터

| amount* | 결제 금액 |  |
| --- | --- | --- |
| orderId* | 주문 번호 | 채번한 주문 번호 |
| orderName* | 상품명 |  |
| customerName* | 주문자명 |  |
| customerEmail* | 주문자 이메일 |  |
| customerMobilePhone* | 주문자 휴대폰 번호 |  |
| successUrl* | 성공 URL | 결제 중 화면 URL |
| failUrl* | 실패 URL | 주문 실패 화면 URL |

- 응답

| paymentKey | 결제의 키값 | 승인 요청 시 필요 |
| --- | --- | --- |
| orderId | 주문번호 |  |
| amount | 결제할 금액 |  |

### <승인>

- **POST** /v1/payments/confirm

- 승인 요청 파라미터

| **paymentKey*** | 결제의 키값 |  |
| --- | --- | --- |
| **orderId*** | 주문번호 |  |
| amount* | 결제할 금액 |  |

- 성공 응답

| **paymentKey** | 결제의 키값 | tid를 뜻함 |
| --- | --- | --- |
| **status** | 결제 처리 상태
`DONE`: 인증된 결제수단으로 요청한 결제가 승인된 상태입니다. | DONE 이면 승인 성공 |
| **approvedAt** | 결제 승인이 일어난 날짜와 시간 정보입니다. 
`yyyy-MM-dd'T'HH:mm:ss±hh:mm` ISO 8601 형식 | (e.g. `2022-01-01T00:00:00+09:00`) |
| **card** | 카드 승인 시 내려오는 객체 |  |
| **card 상세** |  |  |
| approveNo | 승인번호 | 취소요청할 승인TID |

- 실패 응답

| code | 에러 코드 |  |
| --- | --- | --- |
| message | 에러 메시지 |  |

## <취소>

- **POST** /v1/payments/{paymentKey}/cancel

- Path 파라미터

| **paymentKey** | 결제의 키값 | tid를 뜻함 |
| --- | --- | --- |

- Request Body 파라미터

| **cancelReason** | 취소 이유 | “단순 변심” 고정 |
| --- | --- | --- |
| **cancelAmount** | 취소 금액 |  |

- 성공 응답

| status | 처리 상태 | CANCELED |
| --- | --- | --- |

- 실패 응답

| code | 에러 코드 |  |
| --- | --- | --- |
| message | 에러 메시지 |  |