## 연결 정보

URL: jdbc:postgresql://localhost:5432/postgres
Username: postgres
Password: gksfkqhd12@

# 데이터 모델링

## 1. 테이블 명세 (v2)

---

### 1.1 MEMBER (회원)

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
| --- | --- | --- | --- | --- | --- |
| member_no | VARCHAR(20) | NOT NULL |  | PK | 회원번호 (고유 식별자) |
| login_id | VARCHAR(50) | NOT NULL |  | UNIQUE | 로그인 아이디 |
| name | VARCHAR(100) | NOT NULL |  |  | 회원명 |
| password | VARCHAR(255) | NOT NULL |  |  | 암호화된 비밀번호 |
| points | INTEGER | NOT NULL | 0 | CHECK (points >= 0) | 보유 적립금 |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 등록일시 |
| updated_at | TIMESTAMP | NULL |  |  | 수정일시 |

**인덱스**

- PK: member_no
- UNIQUE: login_id

---

### 1.2 PRODUCT (상품)

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
| --- | --- | --- | --- | --- | --- |
| product_no | VARCHAR(20) | NOT NULL |  | PK | 상품번호 (고유 식별자) |
| product_name | VARCHAR(200) | NOT NULL |  |  | 상품명 |
| price | INTEGER | NOT NULL |  | CHECK (price >= 0) | 판매가 |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 등록일시 |
| updated_at | TIMESTAMP | NULL |  |  | 수정일시 |

**인덱스**

- PK: product_no

---

### 1.3 CART (장바구니)

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
| --- | --- | --- | --- | --- | --- |
| cart_id | BIGSERIAL | NOT NULL |  | PK | 장바구니 식별자 |
| member_no | VARCHAR(20) | NOT NULL |  | FK | 회원번호 |
| product_no | VARCHAR(20) | NOT NULL |  | FK | 상품번호 |
| qty | INTEGER | NOT NULL | 1 | CHECK (qty > 0) | 수량 |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 등록일시 |
| updated_at | TIMESTAMP | NULL |  |  | 수정일시 |

**인덱스**

- PK: cart_id
- UNIQUE: (member_no, product_no) — 동일 상품 중복 방지
- INDEX: member_no

---

### 1.4 ORDER_BASE (주문 기본)

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
| --- | --- | --- | --- | --- | --- |
| order_no | VARCHAR(30) | NOT NULL |  | PK | 주문번호 (고유 식별자) |
| member_no | VARCHAR(20) | NOT NULL |  |  | 회원번호 (논리적 참조) |
| order_datetime | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 주문접수일시 |
| orderer_name | VARCHAR(20) | NOT NULL |  | 주문자명 |  |
| orderer_phone | VARCHAR(50) | NULL |  | 주문자 휴대폰 번호 |  |
| orderer_email | VARCHAR(100) | NULL |  | 주문자 이메일 |  |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 등록일시 |
| updated_at | TIMESTAMP | NULL |  |  | 수정일시 |

**인덱스**

- PK: order_no
- INDEX: member_no, order_datetime

---

### 1.5 ORDER_PRODUCT (주문 상품)

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
| --- | --- | --- | --- | --- | --- |
| order_no | VARCHAR(30) | NOT NULL |  | PK, FK | 주문번호 |
| product_no | VARCHAR(20) | NOT NULL |  | PK | 상품번호 |
| product_name | VARCHAR(200) | NOT NULL |  |  | 주문 시점 상품명 (스냅샷) |
| price | INTEGER | NOT NULL |  | CHECK (price >= 0) | 주문 시점 판매가 (스냅샷) |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 등록일시 |
| updated_at | TIMESTAMP | NULL |  |  | 수정일시 |

**인덱스**

- PK: (order_no, product_no)

---

### 1.6 ORDER_DETAIL (주문 상세)

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
| --- | --- | --- | --- | --- | --- |
| order_no | VARCHAR(30) | NOT NULL |  | PK, FK | 주문번호 |
| order_seq | INTEGER | NOT NULL |  | PK | 주문순번 |
| process_seq | INTEGER | NOT NULL |  | PK | 주문처리순번 |
| parent_process_seq | INTEGER | NULL |  |  | 상위처리순번 |
| claim_no | VARCHAR(30) | NULL |  |  | 클레임번호 |
| product_no | VARCHAR(20) | NOT NULL |  | FK | 상품번호 |
| order_type | VARCHAR(10) | NOT NULL |  | CHECK (order_type IN ('ORDER', 'CANCEL')) | 주문내역구분 |
| order_datetime | TIMESTAMP | NOT NULL |  |  | 주문접수일시 |
| complete_datetime | TIMESTAMP | NULL |  |  | 주문완료일시 |
| order_qty | INTEGER | NOT NULL |  | CHECK (order_qty > 0) | 주문수량 |
| cancel_qty | INTEGER | NOT NULL | 0 | CHECK (cancel_qty >= 0) | 취소수량 |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 등록일시 |
| updated_at | TIMESTAMP | NULL |  |  | 수정일시 |

**인덱스**

- PK: (order_no, order_seq, process_seq)
- INDEX: claim_no, product_no

**참고**

- complete_datetime은 주문 성공 시점(결제 승인 완료 시점)을 의미한다.

---

### 1.7 PAYMENT (결제)

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
| --- | --- | --- | --- | --- | --- |
| payment_no | BIGSERIAL | NOT NULL |  | PK | 결제번호 |
| order_no | VARCHAR(30) | NOT NULL |  |  | 주문번호 |
| payment_type | VARCHAR(10) | NOT NULL |  | CHECK (payment_type IN ('PAYMENT', 'REFUND')) | 결제구분 |
| pg_type | VARCHAR(20) | NOT NULL |  | CHECK (pg_type IN ('INICIS', 'TOSS')) | PG구분 |
| payment_method | VARCHAR(10) | NOT NULL |  | CHECK (payment_method IN ('CARD', 'POINT')) | 결제수단 |
| payment_amount | INTEGER | NOT NULL |  |  | 결제금액 |
| claim_no | VARCHAR(30) | NULL |  |  | 클레임번호 |
| remain_refundable_amount | INTEGER | NOT NULL | 0 | CHECK (remain_refundable_amount >= 0) | 환불가능금액 |
| payment_datetime | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 결제완료일시 |
| approval_no | VARCHAR(50) | NULL |  |  | PG 승인번호 |
| tid | VARCHAR(50) | NULL |  |  | PG 거래번호 |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 등록일시 |
| updated_at | TIMESTAMP | NULL |  |  | 수정일시 |

**인덱스**

- PK: payment_no
- INDEX: order_no, claim_no, payment_datetime

---

### 1.8 PAYMENT_INTERFACE (결제 인터페이스)

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
| --- | --- | --- | --- | --- | --- |
| interface_seq | BIGSERIAL | NOT NULL |  | PK | 인터페이스순번 |
| pg_type | VARCHAR(20) | NOT NULL |  | CHECK (pg_type IN ('INICIS', 'TOSS')) | PG구분 |
| transaction_type | VARCHAR(20) | NOT NULL |  | CHECK (transaction_type IN ('APPROVAL', 'CANCEL', 'NET_CANCEL')) | 거래구분 |
| transaction_datetime | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 거래일시 |
| order_no | VARCHAR(30) | NOT NULL |  |  | 주문번호 |
| payment_no | BIGINT | NULL |  |  | 결제번호 |
| request_json | TEXT | NOT NULL |  |  | PG 요청 JSON |
| response_json | TEXT | NULL |  |  | PG 응답 JSON |
| result | VARCHAR(10) | NOT NULL |  | CHECK (result IN ('SUCCESS', 'FAIL')) | 처리결과 |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP |  | 등록일시 |
| updated_at | TIMESTAMP | NULL |  |  | 수정일시 |

**인덱스**

- PK: interface_seq
- INDEX: order_no, payment_no, transaction_datetime

---

## 2. 코드값 정의

### 2.1 주문내역구분 (order_type)

| 코드 | 코드명 | 설명 |
| --- | --- | --- |
| ORDER | 주문 | 정상 주문 |
| CANCEL | 취소 | 주문 취소 |

### 2.2 결제구분 (payment_type)

| 코드 | 코드명 | 설명 |
| --- | --- | --- |
| PAYMENT | 결제 | 결제 승인 |
| REFUND | 환불 | 결제 취소/환불 |

### 2.3 결제수단 (payment_method)

| 코드 | 코드명 | 설명 |
| --- | --- | --- |
| CARD | 신용카드 | 신용/체크카드 결제 |
| POINT | 적립금 | 적립금 결제 |

### 2.4 PG구분 (pg_type)

| 코드 | 코드명 | 설명 |
| --- | --- | --- |
| INICIS | 이니시스 | KG이니시스 |
| TOSS | 토스 | 토스페이먼츠 |

### 2.5 거래구분 (transaction_type)

| 코드 | 코드명 | 설명 |
| --- | --- | --- |
| APPROVAL | 승인 | 결제 승인 |
| CANCEL | 취소 | 결제 취소 |
| NET_CANCEL | 망취소 | 당일 결제 망취소 |

### 2.6 처리결과 (result)

| 코드 | 코드명 | 설명 |
| --- | --- | --- |
| SUCCESS | 성공 | 정상 처리 |
| FAIL | 실패 | 처리 실패 |

---

## 3. 테이블 관계

### 3.1 논리적 관계

- MEMBER (1) : ORDER_BASE (N)
- MEMBER (1) : CART (N)
- PRODUCT (1) : CART (N)
- ORDER_BASE (1) : ORDER_PRODUCT (N)
- ORDER_PRODUCT (1) : ORDER_DETAIL (N)
- PRODUCT (1) : ORDER_PRODUCT (N)
- ORDER_BASE (1) : PAYMENT (N)
- PAYMENT (1) : PAYMENT_INTERFACE (N)

### 3.2 물리적 제약조건 (FK)

- CART.member_no → MEMBER.member_no
- CART.product_no → PRODUCT.product_no
- ORDER_PRODUCT.order_no → ORDER_BASE.order_no
- ORDER_DETAIL.(order_no, product_no) → ORDER_PRODUCT.(order_no, product_no)

### 3.3 FK 미적용 관계

- ORDER_BASE.member_no → MEMBER.member_no
- PAYMENT.order_no → ORDER_BASE.order_no
- PAYMENT_INTERFACE.payment_no → PAYMENT.payment_no

---

## 4. 설계 특징

### 4.1 장바구니 관리

- 회원별 장바구니에 상품 저장
- 동일 상품 중복 방지 (UNIQUE 제약)
- 주문 생성 시 선택된 cart_id 기반으로 ORDER_PRODUCT에 삽입 후 장바구니 데이터 삭제

### 4.2 주문 이력 관리

- ORDER_DETAIL의 process_seq로 주문/취소 이력 관리
- parent_process_seq로 원본 주문과 취소 연결
- 부분취소 시 새로운 process_seq 추가

### 4.3 복합결제 지원

- 하나의 주문에 여러 결제(PAYMENT) 가능

### 4.4 가격 스냅샷

- ORDER_PRODUCT에 주문 시점의 product_name, price 저장

### 4.5 PG 로그 관리

- PAYMENT_INTERFACE에 모든 PG 통신 이력 저장